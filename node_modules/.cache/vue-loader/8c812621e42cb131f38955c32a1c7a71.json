{"remainingRequest":"/Users/jiweiqing/开发/GitHub/jwq-count-app/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/jiweiqing/开发/GitHub/jwq-count-app/src/views/Score/id/index.vue?vue&type=style&index=1&lang=scss&","dependencies":[{"path":"/Users/jiweiqing/开发/GitHub/jwq-count-app/src/views/Score/id/index.vue","mtime":1573383704994},{"path":"/Users/jiweiqing/开发/GitHub/jwq-count-app/node_modules/css-loader/index.js","mtime":499162500000},{"path":"/Users/jiweiqing/开发/GitHub/jwq-count-app/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":499162500000},{"path":"/Users/jiweiqing/开发/GitHub/jwq-count-app/node_modules/postcss-loader/src/index.js","mtime":499162500000},{"path":"/Users/jiweiqing/开发/GitHub/jwq-count-app/node_modules/sass-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/jiweiqing/开发/GitHub/jwq-count-app/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/jiweiqing/开发/GitHub/jwq-count-app/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n.qrCodeDiv {\n    img {\n        margin: auto;\n    }\n}\n",{"version":3,"sources":["index.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAkPA;AACA;AACA;AACA;AACA","file":"index.vue","sourceRoot":"src/views/Score/id","sourcesContent":["<template>\n    <div>\n        <div style=\"margin-top:60px;\">\n            <div\n                style=\"padding:8px;text-align:left;width:80%;margin:auto;overflow:hidden;padding-bottom:.5rem;\"\n                v-if=\"roomInfo.nick_name_list\"\n            >\n                <h2\n                    style=\"display:inline-block;font-size:1.5rem;\"\n                >{{roomInfo.nick_name_list[Number($route.query.addr)]}}</h2>\n                <span style=\"float:right;position:relative;\">\n                    当前总积分：\n                    <b style=\"color:green;font-size:2rem;\">{{selfInfo.score}}</b>\n                </span>\n            </div>\n            <hr />\n            <div style=\"text-align:left;width:80%;margin:auto;\">\n                <div style=\"padding:8px;opacity:.6;overflow:hidden;\">\n                    <span style=\"font-size:.7rem;position:relative;top:.3rem;\">提示：点击每轮右侧的数字进行修改。</span>\n                    <mt-button\n                        type=\"default\"\n                        size=\"small\"\n                        style=\"float:right;font-size:.7rem;\"\n                        @click=\"popupVisible=true\"\n                    >查看排行</mt-button>\n                </div>\n                <mt-cell :title=\"'新一轮（第'+(handleScoreList.length + 1)+'轮）'\">\n                    <span\n                        @click=\"calcRound(handleScoreList.length + 1)\"\n                        :style=\"{'color': 'red'}\"\n                    >请输入</span>\n                </mt-cell>\n                <mt-cell\n                    v-for=\"(item,idx) in handleScoreList\"\n                    :key=\"idx\"\n                    :label=\"item.total===0?'':'未结清'\"\n                    style=\"position:relative;\"\n                >\n                    <div slot=\"title\" @click=\"view(item,handleScoreList.length-1-idx)\">\n                        第{{item.roundId}}轮\n                        <div\n                            v-if=\"item.total!==0\"\n                            style=\"font-size:.7rem;opacity:.5;margin-top:.3rem\"\n                        >{{item.total===0?'':'未结清'}}</div>\n                    </div>\n                    <span\n                        @click.prevent=\"calcRound(item.roundId)\"\n                        :style=\"{'color': item.score===undefined?'red':'gray'}\"\n                    >{{item.score===undefined?'请输入':item.score}}</span>\n                </mt-cell>\n            </div>\n        </div>\n        <mt-popup v-model=\"popupVisible\" popup-transition=\"popup-fade\" style=\"width:80%;\">\n            <h2 style=\"padding:1rem;\">排行榜</h2>\n            <hr />\n            <div style=\"padding:1rem;\">\n                <div\n                    v-for=\"(item,index) in totalScoreList\"\n                    :key=\"index\"\n                    style=\"padding:.2rem;overflow:hidden;\"\n                    :style=\"{'color': Number(item.addr)===Number($route.query.addr)?'green':'#333'}\"\n                >\n                    <span\n                        style=\"width:50%;display:inline-block;text-align:right;float:left;\"\n                    >{{item.name}} ：</span>\n                    <span style=\"margin-left:.4rem;float:left;padding-top:.2rem;\">{{item.score}}</span>\n                </div>\n            </div>\n            <mt-button type=\"default\" style=\"width:100%;\" @click=\"popupVisible=false\">关闭</mt-button>\n        </mt-popup>\n        <mt-popup v-model=\"popupListVisible\" popup-transition=\"popup-fade\" style=\"width:80%;\">\n            <h2 style=\"padding:1rem;\">第{{viewList.roundId}}轮</h2>\n            <hr />\n            <div style=\"padding:1rem;\">\n                <div\n                    v-for=\"(item,index) in viewList.list\"\n                    :key=\"index\"\n                    style=\"padding:.2rem;overflow:hidden;\"\n                    :style=\"{'color': Number(item.addr)===Number($route.query.addr)?'green':'#333'}\"\n                >\n                    <span\n                        style=\"width:50%;display:inline-block;text-align:right;float:left;\"\n                    >{{roomInfo.nick_name_list[Number(item.addr)]}} ：</span>\n                    <span style=\"margin-left:.4rem;float:left;padding-top:.2rem;\">{{item.score}}</span>\n                </div>\n            </div>\n            <mt-button type=\"default\" style=\"width:100%;\" @click=\"popupListVisible=false\">关闭</mt-button>\n        </mt-popup>\n    </div>\n</template>\n\n<script lang=\"ts\">\nimport { Component, Vue } from \"vue-property-decorator\";\nimport { Toast, MessageBox, Popup } from \"mint-ui\";\nimport { getScoreList, handleRoomScore, getRoomInfo } from \"@/req/count\";\n@Component\nexport default class Home extends Vue {\n    public popupVisible = false;\n    public popupListVisible = false;\n    public viewList: any = [];\n    public roomInfo: any = {\n        nick_name_list: []\n    };\n    public scoreList: any = [\n        // {\n        //     roundId: 2,\n        //     list: [\n        //         {\n        //             addr: 2,\n        //             score: -2\n        //         }\n        //     ]\n        // },\n        // {\n        //     roundId: 1,\n        //     list: [\n        //         {\n        //             addr: 1,\n        //             score: -2\n        //         }\n        //     ]\n        // }\n    ];\n    public get selfInfo() {\n        const self: any = {\n            score: 0\n        };\n        let score = 0;\n        this.scoreList.map(i => {\n            i.list.forEach(j => {\n                if (Number(j.addr) === Number(this.$route.query.addr)) {\n                    score += Number(j.score === undefined ? 0 : j.score);\n                }\n            });\n        });\n        self.score = score;\n        return self;\n    }\n    public get totalScoreList() {\n        const list: any = [];\n        for (let a = 0; a < this.roomInfo.nick_name_list.length; a++) {\n            let score = 0;\n            this.scoreList.map(i => {\n                i.list.forEach(j => {\n                    if (Number(j.addr) === Number(a)) {\n                        score += Number(j.score === undefined ? 0 : j.score);\n                    }\n                });\n            });\n            list.push({\n                addr: a,\n                name: this.roomInfo.nick_name_list[a],\n                score\n            });\n        }\n        return list.sort((a, b) => b.score - a.score);\n    }\n    public view(list, idx) {\n        this.viewList = list;\n        console.log(list);\n        this.popupListVisible = true;\n    }\n    public get handleScoreList() {\n        return this.scoreList.map(i => {\n            i.total = 0;\n            i.list.forEach(j => {\n                if (Number(j.addr) === Number(this.$route.query.addr)) {\n                    i.score = j.score;\n                }\n                i.total += Number(j.score === undefined ? 0 : j.score);\n            });\n            return i;\n        });\n    }\n    public mounted() {\n        window.countFn.updateScoreList = () => {\n            this.getScoreList();\n        };\n    }\n    public beforeRouteEnter(to, from, next) {\n        next(vm => {\n            if (window.countFn.updateAddrs === undefined) {\n                return vm.$fn.toRoom(vm.$route.params.id);\n            }\n            vm.getScoreList();\n            vm.getRoomInfo();\n        });\n    }\n    public async getScoreList() {\n        const res = await this.$fn.showMsgResponse(\n            await getScoreList({\n                roomId: this.$route.params.id\n            })\n        );\n        this.scoreList = res.list;\n    }\n    public calcRound(round) {\n        MessageBox.prompt(`请输入你在第${round}轮的分数`).then(\n            async ({ value, action }) => {\n                if (value < 0 || value === \"0\" || value > 0) {\n                    const res = await this.$fn.showMsgResponse(\n                        await handleRoomScore({\n                            roomId: this.$route.params.id,\n                            addrId: Number(this.$route.query.addr),\n                            roundId: Number(round),\n                            score: Number(value)\n                        })\n                    );\n                } else {\n                    Toast({\n                        message: \"请输入整数或者负整数\",\n                        iconClass: \"icon icon-error\",\n                        position: \"top\"\n                    });\n                }\n            }\n        );\n    }\n    public async getRoomInfo() {\n        let roomInfo: any = {};\n        // roomInfo = {\n        //     id: 47,\n        //     room_id: \"1150717815\",\n        //     room_name: \"asdf\",\n        //     count: 123,\n        //     enter_code: \"1234\",\n        //     nick_name_list: \"唐僧,黑熊精,观音,刘备\",\n        //     create_time: \"2019-10-15T14:45:17.000Z\"\n        // };\n        roomInfo = await this.$fn.showMsgResponse(\n            await getRoomInfo({\n                roomId: this.$route.params.id\n            })\n        );\n        roomInfo.nick_name_list = roomInfo.nick_name_list.split(\",\");\n        this.roomInfo = roomInfo;\n    }\n}\n</script>\n<style lang=\"scss\" scoped>\n</style>\n<style lang=\"scss\">\n.qrCodeDiv {\n    img {\n        margin: auto;\n    }\n}\n</style>\n"]}]}